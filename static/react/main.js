(this["webpackJsonpbento-ui"]=this["webpackJsonpbento-ui"]||[]).push([[0],{31:function(t,e,n){t.exports=n(74)},36:function(t,e,n){},37:function(t,e,n){},70:function(t,e){},74:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),i=n(29),r=n.n(i),s=(n(36),n(37),n(9)),c=n.n(s),l=n(10),u=n(5),d=n(6),h=n(8),f=n(7),p=n(4),m=n.n(p),v=n(11),g=n(12),k=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){for(var t=[],e=0;e<this.props.folders.length;e++)t.push(o.a.createElement(b,{type:"folder",name:this.props.folders[e].path,id:this.props.folders[e].id}));if(this.props.documents)for(var n=0;n<this.props.documents.length;n++)t.push(o.a.createElement(b,{type:this.props.documents[n].doc_type,name:this.props.documents[n].name,id:this.props.documents[n].id}));return o.a.createElement("div",null,o.a.createElement("div",{style:{textAlign:"left",maxWidth:"50%",margin:"auto",display:"grid",gridTemplateColumns:"auto auto auto"}},t))}}]),n}(o.a.Component),b=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var t,e=null,n=null,a=null;if("folder"===this.props.type){var i=this.props.name.split("/");e="/folder/"+this.props.id,n=o.a.createElement(v.a,{icon:g.c,size:"6x"}),a=i[i.length-2]}else"text"===this.props.type&&(e="/doc/"+this.props.id,n=o.a.createElement(v.a,{icon:g.b,size:"6x"}),a=this.props.name);return t=o.a.createElement("a",{href:e,style:{color:"white",textDecoration:"none"}},o.a.createElement("div",null,n),o.a.createElement("div",null,o.a.createElement("h3",null," ",a))),o.a.createElement("div",null,o.a.createElement("center",null,t))}}]),n}(o.a.Component),y=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={view:"Grid"},a}return Object(d.a)(n,[{key:"render",value:function(){var t=o.a.createElement("p",null,"loading...");return"Grid"===this.state.view&&(t=o.a.createElement(k,{folders:this.props.folders,documents:this.props.documents})),o.a.createElement("div",null,t)}}]),n}(o.a.Component),E=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(t){return Object(u.a)(this,n),e.call(this,t)}return Object(d.a)(n,[{key:"render",value:function(){return console.log(this.state),o.a.createElement("div",{style:{width:"100%",backgroundColor:"#a0300e",height:"50px"}},o.a.createElement("div",{style:{width:"50px",float:"left"}},o.a.createElement(v.a,{icon:g.a,size:"3x"})),o.a.createElement("div",{style:{width:"50px",float:"left"}},o.a.createElement(v.a,{icon:g.d,size:"3x"})),o.a.createElement("div",{style:{float:"left",marginLeft:"25px",fontSize:"40px"}},"Home"),o.a.createElement("div",{style:{width:"50px",float:"right",marginTop:"1px"}},o.a.createElement(v.a,{icon:g.e,size:"3x"})))}},{key:"componentDidMount",value:function(){var t=this;"folder"in this.props?m.a.get("/api/folder/"+this.props.folder).then((function(e){return t.setState(e.data)})):m.a.get("/api/folder/1").then((function(e){return t.setState(e.data)}))}}]),n}(o.a.Component);var w=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={folders:[],documents:[]},a}return Object(d.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",{style:{width:"100%",backgroundColor:"#a0300e",margin:"0px"}},"Bento!"),o.a.createElement(E,{path:this.props.folder}),o.a.createElement("br",null),o.a.createElement(y,{folders:this.state.folders,documents:this.state.documents}))}},{key:"componentDidMount",value:function(){var t=this;"folder"in this.props?m.a.get("/api/folder/"+this.props.folder).then((function(e){return t.setState(e.data)})):m.a.get("/api/folder/1").then((function(e){return t.setState(e.data)}))}}]),n}(o.a.Component);var _=n(13),j=n(30),O=n.n(j),x=(n(72),n(73)),C=function(t){Object(h.a)(n,t);var e=Object(f.a)(n);function n(t){var a;Object(u.a)(this,n),a=e.call(this,t);var o=(new Date).getTime();return a.state={content:"",old_content:"loading...",hash:0,timestamp:o,diff_stack:[],checking:!1},a.updateContent=a.updateContent.bind(Object(_.a)(a)),a}return Object(d.a)(n,[{key:"hashCode",value:function(t){return t.split("").reduce((function(t,e){return(t<<5)-t+e.charCodeAt(0)|0}),0)}},{key:"postData",value:function(){var t=Object(l.a)(c.a.mark((function t(){var e,n,a,o,i,r=this;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state.content!==this.state.old_content&&(console.log("Start"),console.log(this.state.old_content),console.log(this.state.content),console.log(this.state.diff_stack),console.log("end"),e=x.createPatch("doc",this.state.old_content,this.state.content,"old header","new header",{context:0}),(n=e.split("\n")).splice(0,4),e=n.join("\n"),console.log(e),console.log("Posting diff"),a={time:(new Date).getTime(),content:e,author:"toben",document:this.props.document,parent:this.state.diff_stack[this.state.diff_stack.length-1].diff_hash},o=this.hashCode(JSON.stringify(a)),a.diff_hash=o,(i=this.state.diff_stack).push(a),this.setState({hash:o,timestamp:(new Date).getTime(),old_content:this.state.content,diff_stack:i}),m.a.post("/api/diff/"+this.props.document,a).then((function(t){"failure"===t.data.status&&"The diff provided as parent did not exist."===t.data.reason&&r.postStack()})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"postStack",value:function(){var t=Object(l.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.a.post("/api/diffs/"+this.props.document,this.state.diff_stack).then((function(t){console.log("Stack posted"),console.log(t)}));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateContent",value:function(t){this.setState({content:t})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h2",null,this.props.name),o.a.createElement("br",null),o.a.createElement(O.a,{id:"editor",name:"editor",style:{textAlign:"left"},onChange:this.updateContent,value:this.state.content}),o.a.createElement("br",null),o.a.createElement("a",{href:"/"},"Back"))}},{key:"fillContent",value:function(t){var e=this;console.log(t);var n=t[0].head;null==n&&(n=""),this.setState({content:n,old_content:n,diff_stack:[t[1]]}),setInterval((function(){e.check()}),2e3)}},{key:"componentDidMount",value:function(){var t=this;m.a.get("/api/doc/"+this.props.document).then((function(e){return t.fillContent(e.data)}))}},{key:"pullData",value:function(){var t=this;m.a.get("/api/diff/"+this.props.document).then((function(e){if(e.data.diff_hash!==t.state.diff_stack[t.state.diff_stack.length-1].diff_hash){for(var n=[],a=0;a<t.state.diff_stack.length;a++)n.push(t.state.diff_stack[a].diff_hash);n.includes(e.data.diff_hash)||m.a.get("/api/doc/"+t.props.document).then((function(e){return t.fillContent(e.data)}))}}))}},{key:"check",value:function(){try{if(this.state.checking)return!1;this.setState({checking:!0}),this.postData(),this.pullData(),this.setState({checking:!1})}catch(t){console.error(t)}}}]),n}(o.a.Component);var S=function(){var t="";return t="folder"===window.bento_type?o.a.createElement(w,{folder:window.bento_id,name:window.bento_name}):o.a.createElement(C,{document:window.bento_id,name:window.bento_name}),o.a.createElement("div",{className:"App"},t)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.js.map