(this["webpackJsonpbento-ui"]=this["webpackJsonpbento-ui"]||[]).push([[0],{32:function(t,e,n){t.exports=n(72)},37:function(t,e,n){},38:function(t,e,n){t.exports=n.p+"5d5d9eefa31e5e13a6610d9fa7a283bb.svg"},39:function(t,e,n){},68:function(t,e){},72:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(25),i=n.n(r),s=(n(37),n(6),n(26),n(38),n(39),n(7)),c=n(8),l=n(10),u=n(11),d=n(3),h=n.n(d),f=function(t){Object(u.a)(n,t);var e=Object(l.a)(n);function n(t){var a;return Object(s.a)(this,n),(a=e.call(this,t)).state={folders:["/"],documents:[]},a}return Object(c.a)(n,[{key:"render",value:function(){for(var t=[],e=0;e<this.state.folders.length;e++)t.push(o.a.createElement(p,{type:"folder",name:"/",id:"1"}));for(var n=0;n<this.state.documents.length;n++)t.push(o.a.createElement(p,{type:this.state.documents[n].doc_type,name:this.state.documents[n].name,id:this.state.documents[n].id}));return o.a.createElement("div",null,o.a.createElement("h2",null,"Current path: ",this.props.folder),o.a.createElement("div",{style:{textAlign:"left",maxWidth:"50%",margin:"auto"}},t))}},{key:"componentDidMount",value:function(){var t=this;"folder"in this.props?h.a.get("/api/folder/"+this.props.folder).then((function(e){return t.setState(e.data)})):h.a.get("/api/folder/1").then((function(e){return t.setState(e.data)}))}}]),n}(o.a.Component),p=function(t){Object(u.a)(n,t);var e=Object(l.a)(n);function n(t){var a;return Object(s.a)(this,n),a=e.call(this,t),console.log(JSON.stringify(t)),a}return Object(c.a)(n,[{key:"render",value:function(){var t="\u2049";return"folder"==this.props.type?t="\ud83d\udcc1":"text"==this.props.type&&(t="\u2403"),o.a.createElement("div",null,o.a.createElement("a",{href:"/doc/"+this.props.id},o.a.createElement("h3",null,t," ",this.props.name)))}}]),n}(o.a.Component),m=n(4),v=n.n(m),g=n(9),b=n(27),k=n(28),w=n(5),y=n(31),E=n(30),_=n(29),O=n.n(_),j=(n(70),n(71)),C=function(t){Object(y.a)(n,t);var e=Object(E.a)(n);function n(t){var a;Object(b.a)(this,n),a=e.call(this,t);var o=(new Date).getTime();return a.state={content:"",old_content:"loading...",hash:0,timestamp:o,diff_stack:[]},a.updateContent=a.updateContent.bind(Object(w.a)(a)),a}return Object(k.a)(n,[{key:"hashCode",value:function(t){return t.split("").reduce((function(t,e){return(t<<5)-t+e.charCodeAt(0)|0}),0)}},{key:"postData",value:function(){var t=Object(g.a)(v.a.mark((function t(e){var n,a,o,r,i,s=this;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e!=this.state.old_content&&(n=j.createPatch("doc",this.state.old_content,e,"old header","new header",{context:1}),(a=n.split("\n")).splice(0,4),n=a.join("\n"),console.log(n),console.log("Posting diff"),o={time:(new Date).getTime(),content:n,author:"toben",document:this.props.document,parent:this.state.diff_stack[this.state.diff_stack.length-1].diff_hash},r=this.hashCode(JSON.stringify(o)),o.diff_hash=r,(i=this.state.diff_stack).push(o),this.setState({content:e,hash:r,timestamp:(new Date).getTime(),old_content:e,diff_stack:i}),h.a.post("/api/diff/"+this.props.document,o).then((function(t){"failure"==t.data.status&&"The diff provided as parent did not exist."==t.data.reason&&s.postStack()})));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"postStack",value:function(){var t=Object(g.a)(v.a.mark((function t(){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h.a.post("/api/diffs/"+this.props.document,this.state.diff_stack).then((function(t){console.log("Stack posted"),console.log(t)}));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateContent",value:function(t){console.log(t),console.log(this.state.diff_stack);var e=((new Date).getTime()-this.state.timestamp)/1e3;console.log(e),e>2&&this.postData(t),this.setState({content:t})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h2",null,this.props.name),o.a.createElement("br",null),o.a.createElement(O.a,{id:"editor",name:"editor",onChange:this.updateContent,value:this.state.content}),o.a.createElement("br",null),o.a.createElement("a",{href:"/"},"Back"))}},{key:"componentDidMount",value:function(){var t=this;h.a.get("/api/doc/"+this.props.document).then((function(e){return t.setState({content:e.data[0].head,old_content:e.data[0].head,diff_stack:[e.data[1]]})}))}}]),n}(o.a.Component);var S=function(){var t="";return t="folder"==window.bento_type?o.a.createElement(f,{folder:window.bento_id,name:window.bento_name}):o.a.createElement(C,{document:window.bento_id,name:window.bento_name}),o.a.createElement("div",{className:"App"},o.a.createElement("h1",null,"Bento!"),t)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[32,1,2]]]);
//# sourceMappingURL=main.js.map