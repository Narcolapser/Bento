(this["webpackJsonpbento-ui"]=this["webpackJsonpbento-ui"]||[]).push([[0],{31:function(e,t,n){e.exports=n(74)},36:function(e,t,n){},37:function(e,t,n){},70:function(e,t){},74:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(29),r=n.n(i),s=(n(36),n(37),n(10)),c=n.n(s),l=n(13),u=n(2),h=n(3),d=n(6),p=n(5),f=n(4),v=n(9),m=n.n(v),g=n(12),b=n(11),k=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){for(var e=[],t=0;t<this.props.folders.length;t++)e.push(a.a.createElement(y,{type:"folder",name:this.props.folders[t].path,id:this.props.folders[t].id}));if(this.props.documents)for(var n=0;n<this.props.documents.length;n++)e.push(a.a.createElement(y,{type:this.props.documents[n].doc_type,name:this.props.documents[n].name,id:this.props.documents[n].id}));return a.a.createElement("div",null,a.a.createElement("div",{style:{textAlign:"left",maxWidth:"50%",margin:"auto",display:"grid",gridTemplateColumns:"auto auto auto"}},e))}}]),n}(a.a.Component),y=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={hover:!1,menu_hover:!1},o.hover_on=o.hover_on.bind(Object(d.a)(o)),o.hover_off=o.hover_off.bind(Object(d.a)(o)),o.toggleMenuHover=o.toggleMenuHover.bind(Object(d.a)(o)),o}return Object(h.a)(n,[{key:"hover_on",value:function(){this.setState({hover:!0})}},{key:"hover_off",value:function(){this.setState({hover:!1})}},{key:"toggleMenuHover",value:function(){this.setState({menu_hover:!this.state.menu_hover}),this.setState({hover:!this.state.hover})}},{key:"onClick",value:function(e){window.location=e}},{key:"menu",value:function(e){e.stopPropagation(),console.log("Menu clicked")}},{key:"render",value:function(){var e,t=this,n=null,o=null,i=null;if("folder"===this.props.type){var r=this.props.name.split("/");n="/folder/"+this.props.id,o=a.a.createElement(g.a,{icon:b.d,size:"6x"}),i=r[r.length-2]}else"text"===this.props.type&&(n="/doc/"+this.props.id,o=a.a.createElement(g.a,{icon:b.c,size:"6x"}),i=this.props.name);var s={flex:1,borderRadius:"8px"};this.state.menu_hover&&(s.backgroundColor="#606060"),e=a.a.createElement("div",{onClick:function(){return t.onClick(n)},onMouseEnter:this.hover_on,onMouseLeave:this.hover_off},a.a.createElement("div",null,o),a.a.createElement("div",null,a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("h3",{style:{flex:1}}),a.a.createElement("h3",{style:{flex:6}}," ",i),a.a.createElement("div",{onClick:this.menu,onMouseEnter:this.toggleMenuHover,onMouseLeave:this.toggleMenuHover,style:s}," ",a.a.createElement("h3",null," \u22ee ")))));var c={borderStyle:"solid",paddingTop:"17px",borderRadius:"10px",color:"white",borderColor:"black"};return this.state.hover&&(c.backgroundColor="#505050"),a.a.createElement("div",{style:c},a.a.createElement("center",null,e))}}]),n}(a.a.Component),E=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={view:"Grid"},o}return Object(h.a)(n,[{key:"render",value:function(){var e=a.a.createElement("p",null,"loading...");return"Grid"===this.state.view&&(e=a.a.createElement(k,{folders:this.props.folders,documents:this.props.documents})),a.a.createElement("div",null,e)}}]),n}(a.a.Component),w=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={hover:!1},o.toggleHover=o.toggleHover.bind(Object(d.a)(o)),o}return Object(h.a)(n,[{key:"toggleHover",value:function(){this.setState({hover:!this.state.hover})}},{key:"render",value:function(){var e={width:"50px",float:this.props.float};return this.state.hover&&(e.backgroundColor="#ba5739"),a.a.createElement("div",{style:e,onMouseEnter:this.toggleHover,onMouseLeave:this.toggleHover,onClick:this.props.onClick},a.a.createElement(g.a,{icon:this.props.icon,size:"3x"}))}}]),n}(a.a.Component),_=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(u.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"go_home",value:function(){window.location.href="/"}},{key:"render",value:function(){return console.log(this.state),a.a.createElement("div",{style:{width:"100%",backgroundColor:"#a0300e",height:"50px"}},a.a.createElement(w,{icon:b.a,float:"left",onClick:this.props.open_menu}," "),a.a.createElement(w,{icon:b.f,float:"left",onClick:this.go_home}," "),a.a.createElement("div",{style:{float:"left",marginLeft:"25px",fontSize:"40px"}},"Home"))}},{key:"componentDidMount",value:function(){var e=this;"folder"in this.props?m.a.get("/api/folder/"+this.props.folder).then((function(t){return e.setState(t.data)})):m.a.get("/api/folder/1").then((function(t){return e.setState(t.data)}))}}]),n}(a.a.Component);var j=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e={width:"300px",position:"absolute",height:"100%",backgroundColor:"#ba5739"};this.props.show?e.display="block":e.display="none",console.log("rendering items"),console.log(this.props.links);for(var t=[],n=0;n<this.props.links.length;n++)t.push(a.a.createElement(O,{action:this.props.links[n].action,icon:this.props.links[n].icon,text:this.props.links[n].text}));return console.log(t),a.a.createElement("div",{style:e},t)}}]),n}(a.a.Component),O=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={hover:!1},o.toggleHover=o.toggleHover.bind(Object(d.a)(o)),o}return Object(h.a)(n,[{key:"toggleHover",value:function(){this.setState({hover:!this.state.hover})}},{key:"render",value:function(){var e={display:"flex"};return this.state.hover&&(e.backgroundColor="#b7806f"),a.a.createElement("div",{style:e,onClick:this.props.action,onMouseEnter:this.toggleHover,onMouseLeave:this.toggleHover},a.a.createElement(g.a,{icon:this.props.icon,size:"3x",style:{flex:1}}),a.a.createElement("span",{style:{flex:3,fontSize:"40px"}},this.props.text))}}]),n}(a.a.Component),C=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this,e)).state={folders:[],documents:[],show:!1},o.open_menu=o.open_menu.bind(Object(d.a)(o)),o}return Object(h.a)(n,[{key:"open_menu",value:function(){console.log("opening menu"),console.log(this.state),this.setState({show:!this.state.show})}},{key:"render",value:function(){var e=[{icon:b.g,text:"New File",action:x},{icon:b.e,text:"New Folder",action:function(){alert("Coming soon!")}},{icon:b.b,text:"Settings",action:function(){alert("Coming soon!")}}];return a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("h1",{style:{width:"100%",backgroundColor:"#a0300e",margin:"0px"}},"Bento!"),a.a.createElement(_,{path:this.props.folder,open_menu:this.open_menu})),a.a.createElement("div",null,a.a.createElement(j,{show:this.state.show,links:e}),a.a.createElement("br",null),a.a.createElement(E,{folders:this.state.folders,documents:this.state.documents})))}},{key:"componentDidMount",value:function(){var e=this;"folder"in this.props?m.a.get("/api/folder/"+this.props.folder).then((function(t){return e.setState(t.data)})):m.a.get("/api/folder/1").then((function(t){return e.setState(t.data)}))}}]),n}(a.a.Component);function x(){return S.apply(this,arguments)}function S(){return(S=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=prompt("Name of new document: ","Untitled"),console.log(t),e.next=4,fetch("/api/doc/",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,author:"Toben",path:"/"})}).then((function(e){return console.log("resp: "),console.log(e),e.json()})).then((function(e){console.log(e);var t="/doc/"+e.id;console.log(t),window.location=t}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=n(30),H=n.n(M),D=(n(72),n(73)),T=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var o;Object(u.a)(this,n),o=t.call(this,e);var a=(new Date).getTime();return o.state={content:"",old_content:"loading...",hash:0,timestamp:a,diff_stack:[],checking:!1},o.updateContent=o.updateContent.bind(Object(d.a)(o)),o}return Object(h.a)(n,[{key:"hashCode",value:function(e){return e.split("").reduce((function(e,t){return(e<<5)-e+t.charCodeAt(0)|0}),0)}},{key:"postData",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,o,a,i,r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.content!==this.state.old_content&&(console.log("Start"),console.log(this.state.old_content),console.log(this.state.content),console.log(this.state.diff_stack),console.log("end"),t=D.createPatch("doc",this.state.old_content,this.state.content,"old header","new header",{context:0}),(n=t.split("\n")).splice(0,4),t=n.join("\n"),console.log(t),console.log("Posting diff"),o={time:(new Date).getTime(),content:t,author:"toben",document:this.props.document,parent:this.state.diff_stack[this.state.diff_stack.length-1].diff_hash},a=this.hashCode(JSON.stringify(o)),o.diff_hash=a,(i=this.state.diff_stack).push(o),this.setState({hash:a,timestamp:(new Date).getTime(),old_content:this.state.content,diff_stack:i}),m.a.post("/api/diff/"+this.props.document,o).then((function(e){"failure"===e.data.status&&"The diff provided as parent did not exist."===e.data.reason&&r.postStack()})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"postStack",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.a.post("/api/diffs/"+this.props.document,this.state.diff_stack).then((function(e){console.log("Stack posted"),console.log(e)}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateContent",value:function(e){this.setState({content:e})}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("h2",null,this.props.name),a.a.createElement("br",null),a.a.createElement(H.a,{id:"editor",name:"editor",style:{textAlign:"left"},onChange:this.updateContent,value:this.state.content,spellChecker:"false"}),a.a.createElement("br",null),a.a.createElement("a",{href:"/"},"Back"))}},{key:"fillContent",value:function(e){var t=this;console.log(e);var n=e[0].head;null==n&&(n=""),this.setState({content:n,old_content:n,diff_stack:[e[1]]}),setInterval((function(){t.check()}),2e3)}},{key:"componentDidMount",value:function(){var e=this;m.a.get("/api/doc/"+this.props.document).then((function(t){return e.fillContent(t.data)}))}},{key:"pullData",value:function(){var e=this;m.a.get("/api/diff/"+this.props.document).then((function(t){if(t.data.diff_hash!==e.state.diff_stack[e.state.diff_stack.length-1].diff_hash){for(var n=[],o=0;o<e.state.diff_stack.length;o++)n.push(e.state.diff_stack[o].diff_hash);n.includes(t.data.diff_hash)||m.a.get("/api/doc/"+e.props.document).then((function(t){return e.fillContent(t.data)}))}}))}},{key:"check",value:function(){try{if(this.state.checking)return!1;this.setState({checking:!0}),this.postData(),this.pullData(),this.setState({checking:!1})}catch(e){console.error(e)}}}]),n}(a.a.Component);var z=function(){var e="";return e="folder"===window.bento_type?a.a.createElement(C,{folder:window.bento_id,name:window.bento_name}):a.a.createElement(T,{document:window.bento_id,name:window.bento_name}),a.a.createElement("div",{className:"App"},e)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.js.map